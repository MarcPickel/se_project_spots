!function(){"use strict";function e(e,t,r,n){e.textContent=t?n:r}const t={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-button",inactiveButtonClass:"modal__submit-button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error"},r=(e,t,r)=>{e.querySelector(`#${t.id}-error`).textContent="",t.classList.remove(r.inputErrorClass)},n=(e,t,r)=>{(e=>e.some(e=>!e.validity.valid))(e)?o(t,r):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},o=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)};var a;a=t,document.querySelectorAll(a.formSelector).forEach(e=>{((e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),a=e.querySelector(t.submitButtonSelector);n(o,a,t),o.forEach(s=>{s.addEventListener("input",function(){((e,t,n)=>{t.validity.valid?r(e,t,n):((e,t,r,n)=>{e.querySelector(`#${t.id}-error`).textContent=r,t.classList.add(n.inputErrorClass)})(e,t,t.validationMessage,n)})(e,s,t),n(o,a,t)})})})(e,a)});const s=document.querySelector(".profile__avatar-container"),c=s.querySelector(".profile__avatar"),i=s.querySelector(".profile__avatar-button"),l=document.querySelector(".profile__name"),d=document.querySelector(".profile__description"),u=document.querySelector("#avatar-modal"),m=u.querySelector("#profile-avatar-form"),_=m.querySelector("#avatar-image-input"),h=u.querySelector(".modal__submit-button"),v=u.querySelector(".modal__close-button"),f=document.querySelector(".profile__edit-button"),S=document.querySelector("#edit-profile-modal"),p=S.querySelector(".modal__submit-button"),y=S.querySelector(".modal__close-button"),b=S.querySelector("#edit-profile-form"),q=S.querySelector("#profile-name-input"),k=S.querySelector("#profile-description-input"),L=document.querySelector(".profile__add-button"),g=document.querySelector("#new-post-modal"),E=g.querySelector(".modal__submit-button"),C=g.querySelector(".modal__close-button"),U=g.querySelector("#new-post-form"),$=g.querySelector("#card-image-input"),x=g.querySelector("#card-caption-input");let w,D;const I=document.querySelector("#delete-card-modal"),A=I.querySelector(".modal__form"),R=I.querySelector(".modal__close-button"),T=I.querySelector(".modal__cancel-button"),N=document.querySelector("#preview-modal"),P=N.querySelector(".modal__close-button"),B=N.querySelector(".modal__image"),O=N.querySelector(".modal__caption"),j=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._checkResponse)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._checkResponse)}editAvatarImage({avatar:e}){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse)}editUserInfo({name:e,about:t}){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(this._checkResponse)}getNewCard({name:e,link:t}){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(this._checkResponse)}removeCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}changeLike(e,t){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers}).then(this._checkResponse)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"5ef325c5-f7c1-4719-bb32-13415ad57957","Content-Type":"application/json"}});function J(e){e.classList.add("modal_is-opened"),e.addEventListener("mousedown",z),document.addEventListener("keydown",M)}function H(e){e.classList.remove("modal_is-opened"),e.removeEventListener("mousedown",z),document.removeEventListener("keydown",M)}function z(e){e.target.classList.contains("modal")&&H(e.target)}function M(e){if("Escape"===e.key){const e=document.querySelector(".modal_is-opened");e&&H(e)}}j.getAppInfo().then(([e,t])=>{e.forEach(function(e){const t=K(e);G.append(t)}),c&&(c.src=t.avatar,c.alt=t.name),l.textContent=t.name,d.textContent=t.about}).catch(e=>{console.error(e)}),f.addEventListener("click",function(){q.value=l.textContent,k.value=d.textContent,((e,t,n)=>{t.forEach(t=>{r(e,t,n)})})(b,[q,k],t),J(S)}),i.addEventListener("click",()=>{J(u)}),v.addEventListener("click",()=>{H(u)}),y.addEventListener("click",()=>{H(S)}),L.addEventListener("click",()=>{J(g)}),C.addEventListener("click",()=>{H(g)}),P.addEventListener("click",()=>{H(N)}),R.addEventListener("click",()=>{H(I)}),T.addEventListener("click",()=>{H(I)}),m.addEventListener("submit",function(r){r.preventDefault();const n=r.submitter;e(n,!0,"Save","Saving..."),j.editAvatarImage({avatar:_.value}).then(e=>{e&&(c.src=e.avatar,o(h,t),H(u),r.target.reset())}).catch(e=>{console.error(e)}).finally(()=>{e(n,!1,"Save","Saving...")})}),b.addEventListener("submit",function(r){r.preventDefault();const n=r.submitter;e(n,!0,"Save","Saving..."),j.editUserInfo({name:q.value,about:k.value}).then(e=>{e&&(l.textContent=e.name,d.textContent=e.about,o(p,t),H(S),r.target.reset())}).catch(e=>{console.error(e)}).finally(()=>{e(n,!1,"Save","Saving...")})}),U.addEventListener("submit",function(r){r.preventDefault();const n=r.submitter;e(n,!0,"Save","Saving..."),j.getNewCard({name:x.value,link:$.value}).then(e=>{if(e){const n=K(e);G.prepend(n),o(E,t),H(g),r.target.reset()}}).catch(e=>{console.error(e)}).finally(()=>{e(n,!1,"Save","Saving...")})}),A.addEventListener("submit",function(t){t.preventDefault();const r=t.submitter;e(r,!0,"Delete","Deleting..."),j.removeCard(D).then(()=>{w.remove(),H(I)}).catch(e=>{console.error(e)}).finally(()=>{e(r,!1,"Delete","Deleting...")})});const F=document.querySelector("#card-template").content.querySelector(".card"),G=document.querySelector(".cards__list");function K(e){const t=F.cloneNode(!0),r=t.querySelector(".card__title"),n=t.querySelector(".card__image"),o=t.querySelector(".card__like-button"),a=t.querySelector(".card__delete-button");return r.textContent=e.name,n.src=e.link,n.alt=e.name,e.isLiked?o.classList.add("card__like-button_active"):o.classList.remove("card__like-button_active"),o.addEventListener("click",t=>function(e,t){const r=e.currentTarget,n=r.classList.contains("card__like-button_active");j.changeLike(t,n).then(()=>{r.classList.toggle("card__like-button_active")}).catch(e=>{console.error(e)})}(t,e._id)),a.addEventListener("click",()=>function(e,t){w=e,D=t,J(I)}(t,e._id)),n.addEventListener("click",function(){B.src=e.link,B.alt=e.name,O.textContent=e.name,J(N)}),t}}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RyxFQUFPa0IsVUFBVW9HLFNBQVMsNEJBQzFDM0MsRUFDR2dDLFdBQVcxRixFQUFJMkYsR0FDZmQsS0FBSyxLQUNKOUYsRUFBT2tCLFVBQVVxSSxPQUFPLDhCQUV6QnRCLE1BQU9DLElBQ05DLFFBQVFDLE1BQU1GLElBRXBCLENBaUVJc0IsQ0FBZXBDLEVBQUt1QixFQUFLYyxNQUUzQkosRUFBd0JqSCxpQkFBaUIsUUFBUyxJQXhOcEQsU0FBMEJ1RixFQUFhK0IsR0FDckN6RixFQUFlMEQsRUFDZnpELEVBQWlCd0YsRUFDakI1QyxFQUFVM0MsRUFDWixDQXFOSXdGLENBQWlCaEMsRUFBYWdCLEVBQUtjLE1BR3JDTixFQUFpQi9HLGlCQUFpQixRQUFTLFdBQ3pDcUMsRUFBb0JzRCxJQUFNWSxFQUFLbEMsS0FDL0JoQyxFQUFvQnVELElBQU1XLEVBQUtyQyxLQUMvQjVCLEVBQXNCdEUsWUFBY3VJLEVBQUtyQyxLQUN6Q1EsRUFBVXZDLEVBQ1osR0FFT29ELENBQ1QsQyIsInNvdXJjZXMiOlsid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvdXRpbHMvaGVscGVycy5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3NjcmlwdHMvdmFsaWRhdGlvbi5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvdXRpbHMvYXBpLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBmdW5jdGlvbiBzZXRCdXR0b25UZXh0KGJ1dHRvbiwgaXNMb2FkaW5nLCBkZWZhdWx0VGV4dCwgbG9hZGluZ1RleHQpIHtcbiAgaWYgKGlzTG9hZGluZykge1xuICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9IGxvYWRpbmdUZXh0O1xuICB9IGVsc2Uge1xuICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9IGRlZmF1bHRUZXh0O1xuICB9XG59XG4iLCIvKmNvbnN0IGluaXRpYWxDYXJkcyA9IFtcbiAge1xuICAgIG5hbWU6IFwiR29sZGVuIEdhdGUgYnJpZGdlXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzctcGhvdG8tYnktZ3JpZmZpbi13b29sZHJpZGdlLWZyb20tcGV4ZWxzLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJWYWwgVGhvcmVuc1wiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy8xLXBob3RvLWJ5LW1vcml0ei1mZWxkbWFubi1mcm9tLXBleGVscy5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiUmVzdGF1cmFudCB0ZXJyYWNlXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzItcGhvdG8tYnktY2VpbGluZS1mcm9tLXBleGVscy5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiQW4gb3V0ZG9vciBjYWZlXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzMtcGhvdG8tYnktdHViYW51ci1kb2dhbi1mcm9tLXBleGVscy5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiQSB2ZXJ5IGxvbmcgYnJpZGdlLCBvdmVyIHRoZSBmb3Jlc3QgYW5kIHRocm91Z2ggdGhlIHRyZWVzXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzQtcGhvdG8tYnktbWF1cmljZS1sYXNjaGV0LWZyb20tcGV4ZWxzLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJUdW5uZWwgd2l0aCBtb3JuaW5nIGxpZ2h0XCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzUtcGhvdG8tYnktdmFuLWFuaC1uZ3V5ZW4tZnJvbS1wZXhlbHMuanBnXCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIk1vdW50YWluIGhvdXNlXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzYtcGhvdG8tYnktbW9yaXR6LWZlbGRtYW5uLWZyb20tcGV4ZWxzLmpwZ1wiLFxuICB9LFxuXTsqL1xuXG5jb25zdCBzZXR0aW5ncyA9IHtcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybVwiLFxuICBpbnB1dFNlbGVjdG9yOiBcIi5tb2RhbF9faW5wdXRcIixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19zdWJtaXQtYnV0dG9uXCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX3N1Ym1pdC1idXR0b25fZGlzYWJsZWRcIixcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gIGVycm9yQ2xhc3M6IFwibW9kYWxfX2Vycm9yXCIsXG59O1xuXG5leHBvcnQgeyBzZXR0aW5ncyB9O1xuIiwiY29uc3Qgc2hvd0lucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlLCBjb25maWcpID0+IHtcbiAgY29uc3QgZXJyb3JNZXNzYWdlRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXG4gICk7XG4gIGVycm9yTWVzc2FnZUVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XG4gIGlucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xufTtcblxuY29uc3QgaGlkZUlucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGVycm9yTWVzc2FnZUVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgIGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxuICApO1xuICBlcnJvck1lc3NhZ2VFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcbiAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XG59O1xuXG5jb25zdCBjaGVja0lucHV0VmFsaWRpdHkgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKSA9PiB7XG4gIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgc2hvd0lucHV0RXJyb3IoXG4gICAgICBmb3JtRWxlbWVudCxcbiAgICAgIGlucHV0RWxlbWVudCxcbiAgICAgIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSxcbiAgICAgIGNvbmZpZ1xuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKTtcbiAgfVxufTtcblxuY29uc3QgaGFzSW52YWxpZElucHV0ID0gKGlucHV0TGlzdCkgPT4ge1xuICByZXR1cm4gaW5wdXRMaXN0LnNvbWUoKGlucHV0RWxlbWVudCkgPT4ge1xuICAgIHJldHVybiAhaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkO1xuICB9KTtcbn07XG5cbmNvbnN0IHRvZ2dsZUJ1dHRvblN0YXRlID0gKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKSA9PiB7XG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0LCBjb25maWcpKSB7XG4gICAgZGlzYWJsZUJ1dHRvbihidXR0b25FbGVtZW50LCBjb25maWcpO1xuICB9IGVsc2Uge1xuICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICB9XG59O1xuXG5jb25zdCBkaXNhYmxlQnV0dG9uID0gKGJ1dHRvbkVsZW1lbnQsIGNvbmZpZykgPT4ge1xuICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcbiAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbn07XG5cbmNvbnN0IHJlc2V0VmFsaWRhdGlvbiA9IChmb3JtRWxlbWVudCwgaW5wdXRMaXN0LCBjb25maWcpID0+IHtcbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0LCBjb25maWcpO1xuICB9KTtcbn07XG5cbmNvbnN0IHNldEV2ZW50TGlzdGVuZXJzID0gKGZvcm1FbGVtZW50LCBjb25maWcpID0+IHtcbiAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcbiAgICBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKVxuICApO1xuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcblxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjaGVja0lucHV0VmFsaWRpdHkoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKTtcbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcbiAgICB9KTtcbiAgfSk7XG59O1xuXG5jb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKGNvbmZpZykgPT4ge1xuICBjb25zdCBmb3JtTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmZvcm1TZWxlY3Rvcik7XG4gIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbGVtZW50KSA9PiB7XG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsZW1lbnQsIGNvbmZpZyk7XG4gIH0pO1xufTtcblxuZXhwb3J0IHsgZW5hYmxlVmFsaWRhdGlvbiwgcmVzZXRWYWxpZGF0aW9uLCBkaXNhYmxlQnV0dG9uIH07XG4iLCIvL0ltcG9ydCBDU1NcbmltcG9ydCBcIi4vaW5kZXguY3NzXCI7XG5cbi8vSW1wb3J0IGZyb20gdXRpbHMuanNcbmltcG9ydCBBcGkgZnJvbSBcIi4uL3V0aWxzL2FwaS5qc1wiO1xuaW1wb3J0IHsgc2V0QnV0dG9uVGV4dCB9IGZyb20gXCIuLi91dGlscy9oZWxwZXJzLmpzXCI7XG5cbi8vSW1wb3J0cyBmcm9tIGNvbnN0YW50cy5qc1xuaW1wb3J0IHsgc2V0dGluZ3MgfSBmcm9tIFwiLi4vdXRpbHMvY29uc3RhbnRzLmpzXCI7XG5cbi8vSW1wb3J0cyBmcm9tIHZhbGlkYXRpb24uanNcbmltcG9ydCB7XG4gIGVuYWJsZVZhbGlkYXRpb24sXG4gIHJlc2V0VmFsaWRhdGlvbixcbiAgZGlzYWJsZUJ1dHRvbixcbn0gZnJvbSBcIi4uL3NjcmlwdHMvdmFsaWRhdGlvbi5qc1wiO1xuZW5hYmxlVmFsaWRhdGlvbihzZXR0aW5ncyk7XG5cbi8vIFByb2ZpbGUgRWxlbWVudHNcbmNvbnN0IHByb2ZpbGVBdmF0YXJDb250ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXItY29udGFpbmVyXCIpO1xuY29uc3QgcHJvZmlsZUF2YXRhckVsZW1lbnQgPVxuICBwcm9maWxlQXZhdGFyQ29udC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcbmNvbnN0IHByb2ZpbGVBdmF0YXJCdXR0b24gPSBwcm9maWxlQXZhdGFyQ29udC5xdWVyeVNlbGVjdG9yKFxuICBcIi5wcm9maWxlX19hdmF0YXItYnV0dG9uXCJcbik7XG5jb25zdCBwcm9maWxlTmFtZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIik7XG5jb25zdCBwcm9maWxlRGVzY3JpcHRpb25FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIlxuKTtcblxuLy8gRWRpdCBBdmF0YXIgRWxlbWVudHNcbmNvbnN0IHByb2ZpbGVBdmF0YXJNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYXZhdGFyLW1vZGFsXCIpO1xuY29uc3QgcHJvZmlsZUF2YXRhckZvcm0gPSBwcm9maWxlQXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIjcHJvZmlsZS1hdmF0YXItZm9ybVwiXG4pO1xuY29uc3QgcHJvZmlsZUF2YXRhckxpbmtJbnB1dCA9IHByb2ZpbGVBdmF0YXJGb3JtLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI2F2YXRhci1pbWFnZS1pbnB1dFwiXG4pO1xuY29uc3QgcHJvZmlsZUF2YXRhclN1Ym1pdEJ1dHRvbiA9IHByb2ZpbGVBdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIi5tb2RhbF9fc3VibWl0LWJ1dHRvblwiXG4pO1xuY29uc3QgcHJvZmlsZUF2YXRhckNsb3NlQnV0dG9uID0gcHJvZmlsZUF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLm1vZGFsX19jbG9zZS1idXR0b25cIlxuKTtcblxuLy8gRWRpdCBQcm9maWxlIEVsZW1lbnRzXG5jb25zdCBlZGl0UHJvZmlsZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1idXR0b25cIik7XG5jb25zdCBlZGl0UHJvZmlsZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LXByb2ZpbGUtbW9kYWxcIik7XG5jb25zdCBlZGl0UHJvZmlsZVN1Ym1pdEJ1dHRvbiA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIubW9kYWxfX3N1Ym1pdC1idXR0b25cIlxuKTtcbmNvbnN0IGVkaXRQcm9maWxlQ2xvc2VCdXR0b24gPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLm1vZGFsX19jbG9zZS1idXR0b25cIlxuKTtcbmNvbnN0IGVkaXRQcm9maWxlRm9ybSA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcIiNlZGl0LXByb2ZpbGUtZm9ybVwiKTtcbmNvbnN0IGVkaXRQcm9maWxlTmFtZUlucHV0ID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIiNwcm9maWxlLW5hbWUtaW5wdXRcIlxuKTtcbmNvbnN0IGVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dCA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIjcHJvZmlsZS1kZXNjcmlwdGlvbi1pbnB1dFwiXG4pO1xuXG4vLyBOZXcgUG9zdCBFbGVtZW50c1xuY29uc3QgbmV3UG9zdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ1dHRvblwiKTtcbmNvbnN0IG5ld1Bvc3RNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbmV3LXBvc3QtbW9kYWxcIik7XG5jb25zdCBuZXdQb3N0U3VibWl0QnV0dG9uID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idXR0b25cIik7XG5jb25zdCBuZXdQb3N0Q2xvc2VCdXR0b24gPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnV0dG9uXCIpO1xuY29uc3QgbmV3UG9zdEZvcm0gPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIiNuZXctcG9zdC1mb3JtXCIpO1xuY29uc3QgbmV3UG9zdExpbmtJbnB1dCA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtaW1hZ2UtaW5wdXRcIik7XG5jb25zdCBuZXdQb3N0Q2FwdGlvbklucHV0ID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC1jYXB0aW9uLWlucHV0XCIpO1xuXG4vLyBDYXJkIFJlbGF0ZWQgRWxlbWVudHNcbmxldCBzZWxlY3RlZENhcmQsIHNlbGVjdGVkQ2FyZElkO1xuXG4vLyBEZWxldGUgTW9kYWwgRWxlbWVudHNcbmNvbnN0IGRlbGV0ZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNkZWxldGUtY2FyZC1tb2RhbFwiKTtcbmNvbnN0IGRlbGV0ZUZvcm0gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgZGVsZXRlTW9kYWxDbG9zZUJ1dHRvbiA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLm1vZGFsX19jbG9zZS1idXR0b25cIlxuKTtcbmNvbnN0IGRlbGV0ZU1vZGFsQ2FuY2VsQnV0dG9uID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIubW9kYWxfX2NhbmNlbC1idXR0b25cIlxuKTtcblxuLy8gUHJldmlldyBNb2RhbCBFbGVtZW50c1xuY29uc3QgcHJldmlld01vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcmV2aWV3LW1vZGFsXCIpO1xuY29uc3QgcHJldmlld01vZGFsQ2xvc2VCdXR0b24gPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIubW9kYWxfX2Nsb3NlLWJ1dHRvblwiXG4pO1xuY29uc3QgcHJldmlld0ltYWdlRWxlbWVudCA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZVwiKTtcbmNvbnN0IHByZXZpZXdDYXB0aW9uRWxlbWVudCA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYXB0aW9uXCIpO1xuXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MVwiLFxuICBoZWFkZXJzOiB7XG4gICAgYXV0aG9yaXphdGlvbjogXCI1ZWYzMjVjNS1mN2MxLTQ3MTktYmIzMi0xMzQxNWFkNTc5NTdcIixcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgfSxcbn0pO1xuXG5hcGlcbiAgLmdldEFwcEluZm8oKVxuICAudGhlbigoW2NhcmRzLCB1c2VyXSkgPT4ge1xuICAgIGNhcmRzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoaXRlbSk7XG4gICAgICBjYXJkc0xpc3QuYXBwZW5kKGNhcmRFbGVtZW50KTtcbiAgICB9KTtcbiAgICBpZiAocHJvZmlsZUF2YXRhckVsZW1lbnQpIHtcbiAgICAgIHByb2ZpbGVBdmF0YXJFbGVtZW50LnNyYyA9IHVzZXIuYXZhdGFyO1xuICAgICAgcHJvZmlsZUF2YXRhckVsZW1lbnQuYWx0ID0gdXNlci5uYW1lO1xuICAgIH1cbiAgICBwcm9maWxlTmFtZUVsZW1lbnQudGV4dENvbnRlbnQgPSB1c2VyLm5hbWU7XG4gICAgcHJvZmlsZURlc2NyaXB0aW9uRWxlbWVudC50ZXh0Q29udGVudCA9IHVzZXIuYWJvdXQ7XG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgY29uc29sZS5lcnJvcihlcnIpO1xuICB9KTtcblxuZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9pcy1vcGVuZWRcIik7XG4gIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgbW9kYWxPdmVybGF5Q2xvc2UpO1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVFc2NhcGVDbG9zZSk7XG59XG5cbmZ1bmN0aW9uIGNsb3NlTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX2lzLW9wZW5lZFwiKTtcbiAgbW9kYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBtb2RhbE92ZXJsYXlDbG9zZSk7XG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY2FwZUNsb3NlKTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlQ2FyZChjYXJkRWxlbWVudCwgY2FyZElkKSB7XG4gIHNlbGVjdGVkQ2FyZCA9IGNhcmRFbGVtZW50O1xuICBzZWxlY3RlZENhcmRJZCA9IGNhcmRJZDtcbiAgb3Blbk1vZGFsKGRlbGV0ZU1vZGFsKTtcbn1cblxuZWRpdFByb2ZpbGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgZWRpdFByb2ZpbGVOYW1lSW5wdXQudmFsdWUgPSBwcm9maWxlTmFtZUVsZW1lbnQudGV4dENvbnRlbnQ7XG4gIGVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dC52YWx1ZSA9IHByb2ZpbGVEZXNjcmlwdGlvbkVsZW1lbnQudGV4dENvbnRlbnQ7XG4gIHJlc2V0VmFsaWRhdGlvbihcbiAgICBlZGl0UHJvZmlsZUZvcm0sXG4gICAgW2VkaXRQcm9maWxlTmFtZUlucHV0LCBlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXRdLFxuICAgIHNldHRpbmdzXG4gICk7XG4gIG9wZW5Nb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcbn0pO1xuXG5wcm9maWxlQXZhdGFyQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIG9wZW5Nb2RhbChwcm9maWxlQXZhdGFyTW9kYWwpO1xufSk7XG5cbnByb2ZpbGVBdmF0YXJDbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjbG9zZU1vZGFsKHByb2ZpbGVBdmF0YXJNb2RhbCk7XG59KTtcblxuZWRpdFByb2ZpbGVDbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjbG9zZU1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xufSk7XG5cbm5ld1Bvc3RCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgb3Blbk1vZGFsKG5ld1Bvc3RNb2RhbCk7XG59KTtcblxubmV3UG9zdENsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGNsb3NlTW9kYWwobmV3UG9zdE1vZGFsKTtcbn0pO1xuXG5wcmV2aWV3TW9kYWxDbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjbG9zZU1vZGFsKHByZXZpZXdNb2RhbCk7XG59KTtcblxuZGVsZXRlTW9kYWxDbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjbG9zZU1vZGFsKGRlbGV0ZU1vZGFsKTtcbn0pO1xuXG5kZWxldGVNb2RhbENhbmNlbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjbG9zZU1vZGFsKGRlbGV0ZU1vZGFsKTtcbn0pO1xuXG5mdW5jdGlvbiBoYW5kbGVBdmF0YXJTdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGV2dC5zdWJtaXR0ZXI7XG4gIHNldEJ1dHRvblRleHQoc3VibWl0QnV0dG9uLCB0cnVlLCBcIlNhdmVcIiwgXCJTYXZpbmcuLi5cIik7XG5cbiAgYXBpXG4gICAgLmVkaXRBdmF0YXJJbWFnZSh7XG4gICAgICBhdmF0YXI6IHByb2ZpbGVBdmF0YXJMaW5rSW5wdXQudmFsdWUsXG4gICAgfSlcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgcHJvZmlsZUF2YXRhckVsZW1lbnQuc3JjID0gZGF0YS5hdmF0YXI7XG5cbiAgICAgICAgZGlzYWJsZUJ1dHRvbihwcm9maWxlQXZhdGFyU3VibWl0QnV0dG9uLCBzZXR0aW5ncyk7XG4gICAgICAgIGNsb3NlTW9kYWwocHJvZmlsZUF2YXRhck1vZGFsKTtcbiAgICAgICAgZXZ0LnRhcmdldC5yZXNldCgpO1xuICAgICAgfVxuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHNldEJ1dHRvblRleHQoc3VibWl0QnV0dG9uLCBmYWxzZSwgXCJTYXZlXCIsIFwiU2F2aW5nLi4uXCIpO1xuICAgIH0pO1xufVxucHJvZmlsZUF2YXRhckZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVBdmF0YXJTdWJtaXQpO1xuXG5mdW5jdGlvbiBoYW5kbGVFZGl0UHJvZmlsZVN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgLy8gQ2hhbmdlIHRleHQgY29udGVudCB0byBcIlNhdmluZy4uLlwiIG9yIFwiRGVsZXRpbmcuLi5cIlxuICBjb25zdCBzdWJtaXRCdXR0b24gPSBldnQuc3VibWl0dGVyO1xuICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ1dHRvbiwgdHJ1ZSwgXCJTYXZlXCIsIFwiU2F2aW5nLi4uXCIpO1xuXG4gIGFwaVxuICAgIC5lZGl0VXNlckluZm8oe1xuICAgICAgbmFtZTogZWRpdFByb2ZpbGVOYW1lSW5wdXQudmFsdWUsXG4gICAgICBhYm91dDogZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0LnZhbHVlLFxuICAgIH0pXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgIHByb2ZpbGVOYW1lRWxlbWVudC50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgICAgICAgcHJvZmlsZURlc2NyaXB0aW9uRWxlbWVudC50ZXh0Q29udGVudCA9IGRhdGEuYWJvdXQ7XG5cbiAgICAgICAgZGlzYWJsZUJ1dHRvbihlZGl0UHJvZmlsZVN1Ym1pdEJ1dHRvbiwgc2V0dGluZ3MpO1xuICAgICAgICBjbG9zZU1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xuICAgICAgICBldnQudGFyZ2V0LnJlc2V0KCk7XG4gICAgICB9XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdXR0b24sIGZhbHNlLCBcIlNhdmVcIiwgXCJTYXZpbmcuLi5cIik7XG4gICAgfSk7XG59XG5lZGl0UHJvZmlsZUZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVFZGl0UHJvZmlsZVN1Ym1pdCk7XG5cbmZ1bmN0aW9uIGhhbmRsZU5ld1Bvc3RTdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGV2dC5zdWJtaXR0ZXI7XG4gIHNldEJ1dHRvblRleHQoc3VibWl0QnV0dG9uLCB0cnVlLCBcIlNhdmVcIiwgXCJTYXZpbmcuLi5cIik7XG5cbiAgYXBpXG4gICAgLmdldE5ld0NhcmQoe1xuICAgICAgbmFtZTogbmV3UG9zdENhcHRpb25JbnB1dC52YWx1ZSxcbiAgICAgIGxpbms6IG5ld1Bvc3RMaW5rSW5wdXQudmFsdWUsXG4gICAgfSlcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChkYXRhKTtcbiAgICAgICAgY2FyZHNMaXN0LnByZXBlbmQoY2FyZEVsZW1lbnQpO1xuXG4gICAgICAgIGRpc2FibGVCdXR0b24obmV3UG9zdFN1Ym1pdEJ1dHRvbiwgc2V0dGluZ3MpO1xuICAgICAgICBjbG9zZU1vZGFsKG5ld1Bvc3RNb2RhbCk7XG4gICAgICAgIGV2dC50YXJnZXQucmVzZXQoKTtcbiAgICAgIH1cbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgfSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ1dHRvbiwgZmFsc2UsIFwiU2F2ZVwiLCBcIlNhdmluZy4uLlwiKTtcbiAgICB9KTtcbn1cbm5ld1Bvc3RGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlTmV3UG9zdFN1Ym1pdCk7XG5cbmZ1bmN0aW9uIGhhbmRsZUxpa2VDYXJkKGV2dCwgaWQpIHtcbiAgY29uc3QgYnV0dG9uID0gZXZ0LmN1cnJlbnRUYXJnZXQ7XG4gIGNvbnN0IGlzTGlrZWQgPSBidXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xuICBhcGlcbiAgICAuY2hhbmdlTGlrZShpZCwgaXNMaWtlZClcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBidXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZVN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgY29uc3Qgc3VibWl0QnV0dG9uID0gZXZ0LnN1Ym1pdHRlcjtcbiAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdXR0b24sIHRydWUsIFwiRGVsZXRlXCIsIFwiRGVsZXRpbmcuLi5cIik7XG5cbiAgYXBpXG4gICAgLnJlbW92ZUNhcmQoc2VsZWN0ZWRDYXJkSWQpXG4gICAgLnRoZW4oKCkgPT4ge1xuICAgICAgc2VsZWN0ZWRDYXJkLnJlbW92ZSgpO1xuICAgICAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdXR0b24sIGZhbHNlLCBcIkRlbGV0ZVwiLCBcIkRlbGV0aW5nLi4uXCIpO1xuICAgIH0pO1xufVxuZGVsZXRlRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZURlbGV0ZVN1Ym1pdCk7XG5cbi8vIG1vZGFsT3ZlcmxheUNsb3NlIGZlYXR1cmVcbmZ1bmN0aW9uIG1vZGFsT3ZlcmxheUNsb3NlKGV2dCkge1xuICBpZiAoZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbFwiKSkge1xuICAgIGNsb3NlTW9kYWwoZXZ0LnRhcmdldCk7XG4gIH1cbn1cblxuLy8gaGFuZGxlRXNjYXBlQ2xvc2UgZmVhdHVyZVxuZnVuY3Rpb24gaGFuZGxlRXNjYXBlQ2xvc2UoZXZ0KSB7XG4gIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX2lzLW9wZW5lZFwiKTtcbiAgICBpZiAobW9kYWwpIHtcbiAgICAgIGNsb3NlTW9kYWwobW9kYWwpO1xuICAgIH1cbiAgfVxufVxuXG5jb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudFxuICAucXVlcnlTZWxlY3RvcihcIiNjYXJkLXRlbXBsYXRlXCIpXG4gIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKTtcbmNvbnN0IGNhcmRzTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpc3RcIik7XG5cbmZ1bmN0aW9uIGdldENhcmRFbGVtZW50KGRhdGEpIHtcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkVGVtcGxhdGUuY2xvbmVOb2RlKHRydWUpO1xuICBjb25zdCBjYXJkVGl0bGVFbGVtZW50ID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKTtcbiAgY29uc3QgY2FyZEltYWdlRWxlbWVudCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XG4gIGNvbnN0IGNhcmRMaWtlQnV0dG9uRWxlbWVudCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIik7XG4gIGNvbnN0IGNhcmREZWxldGVCdXR0b25FbGVtZW50ID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICBcIi5jYXJkX19kZWxldGUtYnV0dG9uXCJcbiAgKTtcblxuICBjYXJkVGl0bGVFbGVtZW50LnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICBjYXJkSW1hZ2VFbGVtZW50LnNyYyA9IGRhdGEubGluaztcbiAgY2FyZEltYWdlRWxlbWVudC5hbHQgPSBkYXRhLm5hbWU7XG5cbiAgaWYgKGRhdGEuaXNMaWtlZCkge1xuICAgIGNhcmRMaWtlQnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xuICB9IGVsc2Uge1xuICAgIGNhcmRMaWtlQnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xuICB9XG5cbiAgY2FyZExpa2VCdXR0b25FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PlxuICAgIGhhbmRsZUxpa2VDYXJkKGV2dCwgZGF0YS5faWQpXG4gICk7XG4gIGNhcmREZWxldGVCdXR0b25FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PlxuICAgIGhhbmRsZURlbGV0ZUNhcmQoY2FyZEVsZW1lbnQsIGRhdGEuX2lkKVxuICApO1xuXG4gIGNhcmRJbWFnZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgICBwcmV2aWV3SW1hZ2VFbGVtZW50LnNyYyA9IGRhdGEubGluaztcbiAgICBwcmV2aWV3SW1hZ2VFbGVtZW50LmFsdCA9IGRhdGEubmFtZTtcbiAgICBwcmV2aWV3Q2FwdGlvbkVsZW1lbnQudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gICAgb3Blbk1vZGFsKHByZXZpZXdNb2RhbCk7XG4gIH0pO1xuXG4gIHJldHVybiBjYXJkRWxlbWVudDtcbn1cbiIsImNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XG4gIH1cblxuICBfY2hlY2tSZXNwb25zZShyZXMpIHtcbiAgICBpZiAocmVzLm9rKSB7XG4gICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH1cbiAgfVxuXG4gIGdldEFwcEluZm8oKSB7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldEluaXRpYWxDYXJkcygpLCB0aGlzLmdldFVzZXJJbmZvKCldKTtcbiAgfVxuXG4gIGdldEluaXRpYWxDYXJkcygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBlZGl0QXZhdGFySW1hZ2UoeyBhdmF0YXIgfSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGF2YXRhcixcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBlZGl0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBhYm91dCxcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBnZXROZXdDYXJkKHsgbmFtZSwgbGluayB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGxpbmssXG4gICAgICB9KSxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgcmVtb3ZlQ2FyZChpZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2lkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGNoYW5nZUxpa2UoaWQsIGlzTGlrZWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtpZH0vbGlrZXNgLCB7XG4gICAgICBtZXRob2Q6IGlzTGlrZWQgPyBcIkRFTEVURVwiIDogXCJQVVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBBcGk7XG4iXSwibmFtZXMiOlsic2V0QnV0dG9uVGV4dCIsImJ1dHRvbiIsImlzTG9hZGluZyIsImRlZmF1bHRUZXh0IiwibG9hZGluZ1RleHQiLCJ0ZXh0Q29udGVudCIsInNldHRpbmdzIiwiZm9ybVNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJoaWRlSW5wdXRFcnJvciIsImZvcm1FbGVtZW50IiwiaW5wdXRFbGVtZW50IiwiY29uZmlnIiwicXVlcnlTZWxlY3RvciIsImlkIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJidXR0b25FbGVtZW50Iiwic29tZSIsInZhbGlkaXR5IiwidmFsaWQiLCJoYXNJbnZhbGlkSW5wdXQiLCJkaXNhYmxlQnV0dG9uIiwiZGlzYWJsZWQiLCJhZGQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJBcnJheSIsImZyb20iLCJhZGRFdmVudExpc3RlbmVyIiwiY2hlY2tJbnB1dFZhbGlkaXR5Iiwic2hvd0lucHV0RXJyb3IiLCJlcnJvck1lc3NhZ2UiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsInByb2ZpbGVBdmF0YXJDb250IiwicHJvZmlsZUF2YXRhckVsZW1lbnQiLCJwcm9maWxlQXZhdGFyQnV0dG9uIiwicHJvZmlsZU5hbWVFbGVtZW50IiwicHJvZmlsZURlc2NyaXB0aW9uRWxlbWVudCIsInByb2ZpbGVBdmF0YXJNb2RhbCIsInByb2ZpbGVBdmF0YXJGb3JtIiwicHJvZmlsZUF2YXRhckxpbmtJbnB1dCIsInByb2ZpbGVBdmF0YXJTdWJtaXRCdXR0b24iLCJwcm9maWxlQXZhdGFyQ2xvc2VCdXR0b24iLCJlZGl0UHJvZmlsZUJ1dHRvbiIsImVkaXRQcm9maWxlTW9kYWwiLCJlZGl0UHJvZmlsZVN1Ym1pdEJ1dHRvbiIsImVkaXRQcm9maWxlQ2xvc2VCdXR0b24iLCJlZGl0UHJvZmlsZUZvcm0iLCJlZGl0UHJvZmlsZU5hbWVJbnB1dCIsImVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dCIsIm5ld1Bvc3RCdXR0b24iLCJuZXdQb3N0TW9kYWwiLCJuZXdQb3N0U3VibWl0QnV0dG9uIiwibmV3UG9zdENsb3NlQnV0dG9uIiwibmV3UG9zdEZvcm0iLCJuZXdQb3N0TGlua0lucHV0IiwibmV3UG9zdENhcHRpb25JbnB1dCIsInNlbGVjdGVkQ2FyZCIsInNlbGVjdGVkQ2FyZElkIiwiZGVsZXRlTW9kYWwiLCJkZWxldGVGb3JtIiwiZGVsZXRlTW9kYWxDbG9zZUJ1dHRvbiIsImRlbGV0ZU1vZGFsQ2FuY2VsQnV0dG9uIiwicHJldmlld01vZGFsIiwicHJldmlld01vZGFsQ2xvc2VCdXR0b24iLCJwcmV2aWV3SW1hZ2VFbGVtZW50IiwicHJldmlld0NhcHRpb25FbGVtZW50IiwiYXBpIiwiY29uc3RydWN0b3IiLCJiYXNlVXJsIiwiaGVhZGVycyIsInRoaXMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiX2NoZWNrUmVzcG9uc2UiLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiZ2V0QXBwSW5mbyIsImFsbCIsImdldEluaXRpYWxDYXJkcyIsImdldFVzZXJJbmZvIiwiZmV0Y2giLCJ0aGVuIiwiZWRpdEF2YXRhckltYWdlIiwiYXZhdGFyIiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJlZGl0VXNlckluZm8iLCJuYW1lIiwiYWJvdXQiLCJnZXROZXdDYXJkIiwibGluayIsInJlbW92ZUNhcmQiLCJjaGFuZ2VMaWtlIiwiaXNMaWtlZCIsImF1dGhvcml6YXRpb24iLCJvcGVuTW9kYWwiLCJtb2RhbCIsIm1vZGFsT3ZlcmxheUNsb3NlIiwiaGFuZGxlRXNjYXBlQ2xvc2UiLCJjbG9zZU1vZGFsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImV2dCIsInRhcmdldCIsImNvbnRhaW5zIiwia2V5IiwiY2FyZHMiLCJ1c2VyIiwiaXRlbSIsImNhcmRFbGVtZW50IiwiZ2V0Q2FyZEVsZW1lbnQiLCJjYXJkc0xpc3QiLCJhcHBlbmQiLCJzcmMiLCJhbHQiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJlcnJvciIsInZhbHVlIiwicmVzZXRWYWxpZGF0aW9uIiwiaW5wdXQiLCJwcmV2ZW50RGVmYXVsdCIsInN1Ym1pdEJ1dHRvbiIsInN1Ym1pdHRlciIsImRhdGEiLCJyZXNldCIsImZpbmFsbHkiLCJwcmVwZW5kIiwiY2FyZFRlbXBsYXRlIiwiY29udGVudCIsImNsb25lTm9kZSIsImNhcmRUaXRsZUVsZW1lbnQiLCJjYXJkSW1hZ2VFbGVtZW50IiwiY2FyZExpa2VCdXR0b25FbGVtZW50IiwiY2FyZERlbGV0ZUJ1dHRvbkVsZW1lbnQiLCJjdXJyZW50VGFyZ2V0IiwidG9nZ2xlIiwiaGFuZGxlTGlrZUNhcmQiLCJfaWQiLCJjYXJkSWQiLCJoYW5kbGVEZWxldGVDYXJkIl0sInNvdXJjZVJvb3QiOiIifQ==