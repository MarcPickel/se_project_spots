!function(){"use strict";function e(e,t,r,n){e.textContent=t?n:r}const t={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-button",inactiveButtonClass:"modal__submit-button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error"},r=(e,t,r)=>{e.querySelector(`#${t.id}-error`).textContent="",t.classList.remove(r.inputErrorClass)},n=(e,t,r)=>{(e=>e.some(e=>!e.validity.valid))(e)?o(t,r):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},o=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)};var a;a=t,document.querySelectorAll(a.formSelector).forEach(e=>{((e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),a=e.querySelector(t.submitButtonSelector);n(o,a,t),o.forEach(s=>{s.addEventListener("input",function(){((e,t,n)=>{t.validity.valid?r(e,t,n):((e,t,r,n)=>{e.querySelector(`#${t.id}-error`).textContent=r,t.classList.add(n.inputErrorClass)})(e,t,t.validationMessage,n)})(e,s,t),n(o,a,t)})})})(e,a)});const s=document.querySelector(".profile__avatar-container"),c=s.querySelector(".profile__avatar"),i=s.querySelector(".profile__avatar-button"),l=document.querySelector(".profile__name"),d=document.querySelector(".profile__description"),u=document.querySelector("#avatar-modal"),m=u.querySelector("#profile-avatar-form"),_=m.querySelector("#avatar-image-input"),h=u.querySelector(".modal__submit-button"),v=u.querySelector(".modal__close-button"),f=document.querySelector(".profile__edit-button"),S=document.querySelector("#edit-profile-modal"),p=S.querySelector(".modal__submit-button"),y=S.querySelector(".modal__close-button"),b=S.querySelector("#edit-profile-form"),q=S.querySelector("#profile-name-input"),k=S.querySelector("#profile-description-input"),L=document.querySelector(".profile__add-button"),g=document.querySelector("#new-post-modal"),E=g.querySelector(".modal__submit-button"),C=g.querySelector(".modal__close-button"),U=g.querySelector("#new-post-form"),$=g.querySelector("#card-image-input"),x=g.querySelector("#card-caption-input");let w,D;const I=document.querySelector("#delete-card-modal"),A=I.querySelector(".modal__form"),R=I.querySelector(".modal__close-button"),T=I.querySelector(".modal__cancel-button"),N=document.querySelector("#preview-modal"),P=N.querySelector(".modal__close-button"),B=N.querySelector(".modal__image"),O=N.querySelector(".modal__caption"),j=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._checkResponse)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._checkResponse)}editAvatarImage({avatar:e}){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse)}editUserInfo({name:e,about:t}){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(this._checkResponse)}getNewCard({name:e,link:t}){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(this._checkResponse)}removeCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}changeLike(e,t){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers}).then(this._checkResponse)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"5ef325c5-f7c1-4719-bb32-13415ad57957","Content-Type":"application/json"}});function J(e){e.classList.add("modal_is-opened"),e.addEventListener("mousedown",z),document.addEventListener("keydown",M)}function H(e){e.classList.remove("modal_is-opened"),e.removeEventListener("mousedown",z),document.removeEventListener("keydown",M)}function z(e){e.target.classList.contains("modal")&&H(e.target)}function M(e){if("Escape"===e.key){const e=document.querySelector(".modal_is-opened");e&&H(e)}}j.getAppInfo().then(([e,t])=>{e.forEach(function(e){const t=K(e);G.append(t)}),c&&(c.src=t.avatar,c.alt=t.name),l.textContent=t.name,d.textContent=t.about}).catch(e=>{console.error(e)}),f.addEventListener("click",function(){q.value=l.textContent,k.value=d.textContent,((e,t,n)=>{t.forEach(t=>{r(e,t,n)})})(b,[q,k],t),J(S)}),i.addEventListener("click",()=>{J(u)}),v.addEventListener("click",()=>{H(u)}),y.addEventListener("click",()=>{H(S)}),L.addEventListener("click",()=>{J(g)}),C.addEventListener("click",()=>{H(g)}),P.addEventListener("click",()=>{H(N)}),R.addEventListener("click",()=>{H(I)}),T.addEventListener("click",()=>{H(I)}),m.addEventListener("submit",function(r){r.preventDefault();const n=r.submitter;e(n,!0,"Save","Saving..."),j.editAvatarImage({avatar:_.value}).then(e=>{e&&(c.src=e.avatar,o(h,t),H(u),r.target.reset())}).catch(e=>{console.error(e)}).finally(()=>{e(n,!1,"Save","Saving...")})}),b.addEventListener("submit",function(r){r.preventDefault();const n=r.submitter;e(n,!0,"Save","Saving..."),j.editUserInfo({name:q.value,about:k.value}).then(e=>{e&&(l.textContent=e.name,d.textContent=e.about,o(p,t),H(S),r.target.reset())}).catch(e=>{console.error(e)}).finally(()=>{e(n,!1,"Save","Saving...")})}),U.addEventListener("submit",function(r){r.preventDefault();const n=r.submitter;e(n,!0,"Save","Saving..."),j.getNewCard({name:x.value,link:$.value}).then(e=>{if(e){const n=K(e);G.prepend(n),o(E,t),H(g),r.target.reset()}}).catch(e=>{console.error(e)}).finally(()=>{e(n,!1,"Save","Saving...")})}),A.addEventListener("submit",function(t){t.preventDefault();const r=t.submitter;e(r,!0,"Delete","Deleting..."),j.removeCard(D).then(()=>{w.remove(),H(I)}).catch(e=>{console.error(e)}).finally(()=>{e(r,!1,"Delete","Deleting...")})});const F=document.querySelector("#card-template").content.querySelector(".card"),G=document.querySelector(".cards__list");function K(e){const t=F.cloneNode(!0),r=t.querySelector(".card__title"),n=t.querySelector(".card__image"),o=t.querySelector(".card__like-button"),a=t.querySelector(".card__delete-button");return r.textContent=e.name,n.src=e.link,n.alt=e.name,e.isLiked?o.classList.add("card__like-button_active"):o.classList.remove("card__like-button_active"),o.addEventListener("click",t=>function(e,t){const r=e.currentTarget,n=r.classList.contains("card__like-button_active");j.changeLike(t,n).then(()=>{r.classList.toggle("card__like-button_active")}).catch(e=>{console.error(e)})}(t,e._id)),a.addEventListener("click",()=>function(e,t){w=e,D=t,J(I)}(t,e._id)),n.addEventListener("click",function(){B.src=e.link,B.alt=e.name,O.textContent=e.name,J(N)}),t}}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RyxFQUFPa0IsVUFBVW9HLFNBQVMsNEJBQzFDM0MsRUFDR2dDLFdBQVcxRixFQUFJMkYsR0FDZmQsS0FBSyxLQUNKOUYsRUFBT2tCLFVBQVVxSSxPQUFPLDhCQUV6QnRCLE1BQU9DLElBQ05DLFFBQVFDLE1BQU1GLElBRXBCLENBaUVJc0IsQ0FBZXBDLEVBQUt1QixFQUFLYyxNQUUzQkosRUFBd0JqSCxpQkFBaUIsUUFBUyxJQXhOcEQsU0FBMEJ1RixFQUFhK0IsR0FDckN6RixFQUFlMEQsRUFDZnpELEVBQWlCd0YsRUFDakI1QyxFQUFVM0MsRUFDWixDQXFOSXdGLENBQWlCaEMsRUFBYWdCLEVBQUtjLE1BR3JDTixFQUFpQi9HLGlCQUFpQixRQUFTLFdBQ3pDcUMsRUFBb0JzRCxJQUFNWSxFQUFLbEMsS0FDL0JoQyxFQUFvQnVELElBQU1XLEVBQUtyQyxLQUMvQjVCLEVBQXNCdEUsWUFBY3VJLEVBQUtyQyxLQUN6Q1EsRUFBVXZDLEVBQ1osR0FFT29ELENBQ1QsQyIsInNvdXJjZXMiOlsid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvdXRpbHMvaGVscGVycy5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3NjcmlwdHMvdmFsaWRhdGlvbi5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvdXRpbHMvYXBpLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBmdW5jdGlvbiBzZXRCdXR0b25UZXh0KGJ1dHRvbiwgaXNMb2FkaW5nLCBkZWZhdWx0VGV4dCwgbG9hZGluZ1RleHQpIHtcclxuICBpZiAoaXNMb2FkaW5nKSB7XHJcbiAgICBidXR0b24udGV4dENvbnRlbnQgPSBsb2FkaW5nVGV4dDtcclxuICB9IGVsc2Uge1xyXG4gICAgYnV0dG9uLnRleHRDb250ZW50ID0gZGVmYXVsdFRleHQ7XHJcbiAgfVxyXG59XHJcbiIsIi8qY29uc3QgaW5pdGlhbENhcmRzID0gW1xyXG4gIHtcclxuICAgIG5hbWU6IFwiR29sZGVuIEdhdGUgYnJpZGdlXCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNy1waG90by1ieS1ncmlmZmluLXdvb2xkcmlkZ2UtZnJvbS1wZXhlbHMuanBnXCIsXHJcbiAgfSxcclxuICB7XHJcbiAgICBuYW1lOiBcIlZhbCBUaG9yZW5zXCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvMS1waG90by1ieS1tb3JpdHotZmVsZG1hbm4tZnJvbS1wZXhlbHMuanBnXCIsXHJcbiAgfSxcclxuICB7XHJcbiAgICBuYW1lOiBcIlJlc3RhdXJhbnQgdGVycmFjZVwiLFxyXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzItcGhvdG8tYnktY2VpbGluZS1mcm9tLXBleGVscy5qcGdcIixcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6IFwiQW4gb3V0ZG9vciBjYWZlXCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvMy1waG90by1ieS10dWJhbnVyLWRvZ2FuLWZyb20tcGV4ZWxzLmpwZ1wiLFxyXG4gIH0sXHJcbiAge1xyXG4gICAgbmFtZTogXCJBIHZlcnkgbG9uZyBicmlkZ2UsIG92ZXIgdGhlIGZvcmVzdCBhbmQgdGhyb3VnaCB0aGUgdHJlZXNcIixcclxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy80LXBob3RvLWJ5LW1hdXJpY2UtbGFzY2hldC1mcm9tLXBleGVscy5qcGdcIixcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6IFwiVHVubmVsIHdpdGggbW9ybmluZyBsaWdodFwiLFxyXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzUtcGhvdG8tYnktdmFuLWFuaC1uZ3V5ZW4tZnJvbS1wZXhlbHMuanBnXCIsXHJcbiAgfSxcclxuICB7XHJcbiAgICBuYW1lOiBcIk1vdW50YWluIGhvdXNlXCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNi1waG90by1ieS1tb3JpdHotZmVsZG1hbm4tZnJvbS1wZXhlbHMuanBnXCIsXHJcbiAgfSxcclxuXTsqL1xyXG5cclxuY29uc3Qgc2V0dGluZ3MgPSB7XHJcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybVwiLFxyXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0LWJ1dHRvblwiLFxyXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX3N1Ym1pdC1idXR0b25fZGlzYWJsZWRcIixcclxuICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X3R5cGVfZXJyb3JcIixcclxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19lcnJvclwiLFxyXG59O1xyXG5cclxuZXhwb3J0IHsgc2V0dGluZ3MgfTtcclxuIiwiY29uc3Qgc2hvd0lucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlLCBjb25maWcpID0+IHtcclxuICBjb25zdCBlcnJvck1lc3NhZ2VFbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgIGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxyXG4gICk7XHJcbiAgZXJyb3JNZXNzYWdlRWxlbWVudC50ZXh0Q29udGVudCA9IGVycm9yTWVzc2FnZTtcclxuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcclxufTtcclxuXHJcbmNvbnN0IGhpZGVJbnB1dEVycm9yID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZykgPT4ge1xyXG4gIGNvbnN0IGVycm9yTWVzc2FnZUVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXHJcbiAgKTtcclxuICBlcnJvck1lc3NhZ2VFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcclxuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcclxufTtcclxuXHJcbmNvbnN0IGNoZWNrSW5wdXRWYWxpZGl0eSA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpID0+IHtcclxuICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgc2hvd0lucHV0RXJyb3IoXHJcbiAgICAgIGZvcm1FbGVtZW50LFxyXG4gICAgICBpbnB1dEVsZW1lbnQsXHJcbiAgICAgIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSxcclxuICAgICAgY29uZmlnXHJcbiAgICApO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpO1xyXG4gIH1cclxufTtcclxuXHJcbmNvbnN0IGhhc0ludmFsaWRJbnB1dCA9IChpbnB1dExpc3QpID0+IHtcclxuICByZXR1cm4gaW5wdXRMaXN0LnNvbWUoKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgcmV0dXJuICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQ7XHJcbiAgfSk7XHJcbn07XHJcblxyXG5jb25zdCB0b2dnbGVCdXR0b25TdGF0ZSA9IChpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZykgPT4ge1xyXG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0LCBjb25maWcpKSB7XHJcbiAgICBkaXNhYmxlQnV0dG9uKGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgfVxyXG59O1xyXG5cclxuY29uc3QgZGlzYWJsZUJ1dHRvbiA9IChidXR0b25FbGVtZW50LCBjb25maWcpID0+IHtcclxuICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcclxuICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG59O1xyXG5cclxuY29uc3QgcmVzZXRWYWxpZGF0aW9uID0gKGZvcm1FbGVtZW50LCBpbnB1dExpc3QsIGNvbmZpZykgPT4ge1xyXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0LCBjb25maWcpO1xyXG4gIH0pO1xyXG59O1xyXG5cclxuY29uc3Qgc2V0RXZlbnRMaXN0ZW5lcnMgPSAoZm9ybUVsZW1lbnQsIGNvbmZpZykgPT4ge1xyXG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oXHJcbiAgICBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKVxyXG4gICk7XHJcbiAgY29uc3QgYnV0dG9uRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoY29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcclxuXHJcbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBjb25maWcpO1xyXG5cclxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZyk7XHJcbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59O1xyXG5cclxuY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChjb25maWcpID0+IHtcclxuICBjb25zdCBmb3JtTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmZvcm1TZWxlY3Rvcik7XHJcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsZW1lbnQpID0+IHtcclxuICAgIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbGVtZW50LCBjb25maWcpO1xyXG4gIH0pO1xyXG59O1xyXG5cclxuZXhwb3J0IHsgZW5hYmxlVmFsaWRhdGlvbiwgcmVzZXRWYWxpZGF0aW9uLCBkaXNhYmxlQnV0dG9uIH07XHJcbiIsIi8vSW1wb3J0IENTU1xuaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcblxuLy9JbXBvcnQgZnJvbSB1dGlscy5qc1xuaW1wb3J0IEFwaSBmcm9tIFwiLi4vdXRpbHMvYXBpLmpzXCI7XG5pbXBvcnQgeyBzZXRCdXR0b25UZXh0IH0gZnJvbSBcIi4uL3V0aWxzL2hlbHBlcnMuanNcIjtcblxuLy9JbXBvcnRzIGZyb20gY29uc3RhbnRzLmpzXG5pbXBvcnQgeyBzZXR0aW5ncyB9IGZyb20gXCIuLi91dGlscy9jb25zdGFudHMuanNcIjtcblxuLy9JbXBvcnRzIGZyb20gdmFsaWRhdGlvbi5qc1xuaW1wb3J0IHtcbiAgZW5hYmxlVmFsaWRhdGlvbixcbiAgcmVzZXRWYWxpZGF0aW9uLFxuICBkaXNhYmxlQnV0dG9uLFxufSBmcm9tIFwiLi4vc2NyaXB0cy92YWxpZGF0aW9uLmpzXCI7XG5lbmFibGVWYWxpZGF0aW9uKHNldHRpbmdzKTtcblxuLy8gUHJvZmlsZSBFbGVtZW50c1xuY29uc3QgcHJvZmlsZUF2YXRhckNvbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhci1jb250YWluZXJcIik7XG5jb25zdCBwcm9maWxlQXZhdGFyRWxlbWVudCA9XG4gIHByb2ZpbGVBdmF0YXJDb250LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xuY29uc3QgcHJvZmlsZUF2YXRhckJ1dHRvbiA9IHByb2ZpbGVBdmF0YXJDb250LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLnByb2ZpbGVfX2F2YXRhci1idXR0b25cIlxuKTtcbmNvbnN0IHByb2ZpbGVOYW1lRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcbmNvbnN0IHByb2ZpbGVEZXNjcmlwdGlvbkVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICBcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiXG4pO1xuXG4vLyBFZGl0IEF2YXRhciBFbGVtZW50c1xuY29uc3QgcHJvZmlsZUF2YXRhck1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhdmF0YXItbW9kYWxcIik7XG5jb25zdCBwcm9maWxlQXZhdGFyRm9ybSA9IHByb2ZpbGVBdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIiNwcm9maWxlLWF2YXRhci1mb3JtXCJcbik7XG5jb25zdCBwcm9maWxlQXZhdGFyTGlua0lucHV0ID0gcHJvZmlsZUF2YXRhckZvcm0ucXVlcnlTZWxlY3RvcihcbiAgXCIjYXZhdGFyLWltYWdlLWlucHV0XCJcbik7XG5jb25zdCBwcm9maWxlQXZhdGFyU3VibWl0QnV0dG9uID0gcHJvZmlsZUF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLm1vZGFsX19zdWJtaXQtYnV0dG9uXCJcbik7XG5jb25zdCBwcm9maWxlQXZhdGFyQ2xvc2VCdXR0b24gPSBwcm9maWxlQXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIubW9kYWxfX2Nsb3NlLWJ1dHRvblwiXG4pO1xuXG4vLyBFZGl0IFByb2ZpbGUgRWxlbWVudHNcbmNvbnN0IGVkaXRQcm9maWxlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ1dHRvblwiKTtcbmNvbnN0IGVkaXRQcm9maWxlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtcHJvZmlsZS1tb2RhbFwiKTtcbmNvbnN0IGVkaXRQcm9maWxlU3VibWl0QnV0dG9uID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIi5tb2RhbF9fc3VibWl0LWJ1dHRvblwiXG4pO1xuY29uc3QgZWRpdFByb2ZpbGVDbG9zZUJ1dHRvbiA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIubW9kYWxfX2Nsb3NlLWJ1dHRvblwiXG4pO1xuY29uc3QgZWRpdFByb2ZpbGVGb3JtID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtcHJvZmlsZS1mb3JtXCIpO1xuY29uc3QgZWRpdFByb2ZpbGVOYW1lSW5wdXQgPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3Byb2ZpbGUtbmFtZS1pbnB1dFwiXG4pO1xuY29uc3QgZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0ID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIiNwcm9maWxlLWRlc2NyaXB0aW9uLWlucHV0XCJcbik7XG5cbi8vIE5ldyBQb3N0IEVsZW1lbnRzXG5jb25zdCBuZXdQb3N0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hZGQtYnV0dG9uXCIpO1xuY29uc3QgbmV3UG9zdE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNuZXctcG9zdC1tb2RhbFwiKTtcbmNvbnN0IG5ld1Bvc3RTdWJtaXRCdXR0b24gPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0LWJ1dHRvblwiKTtcbmNvbnN0IG5ld1Bvc3RDbG9zZUJ1dHRvbiA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idXR0b25cIik7XG5jb25zdCBuZXdQb3N0Rm9ybSA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI25ldy1wb3N0LWZvcm1cIik7XG5jb25zdCBuZXdQb3N0TGlua0lucHV0ID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC1pbWFnZS1pbnB1dFwiKTtcbmNvbnN0IG5ld1Bvc3RDYXB0aW9uSW5wdXQgPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIiNjYXJkLWNhcHRpb24taW5wdXRcIik7XG5cbi8vIENhcmQgUmVsYXRlZCBFbGVtZW50c1xubGV0IHNlbGVjdGVkQ2FyZCwgc2VsZWN0ZWRDYXJkSWQ7XG5cbi8vIERlbGV0ZSBNb2RhbCBFbGVtZW50c1xuY29uc3QgZGVsZXRlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2RlbGV0ZS1jYXJkLW1vZGFsXCIpO1xuY29uc3QgZGVsZXRlRm9ybSA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5jb25zdCBkZWxldGVNb2RhbENsb3NlQnV0dG9uID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIubW9kYWxfX2Nsb3NlLWJ1dHRvblwiXG4pO1xuY29uc3QgZGVsZXRlTW9kYWxDYW5jZWxCdXR0b24gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIi5tb2RhbF9fY2FuY2VsLWJ1dHRvblwiXG4pO1xuXG4vLyBQcmV2aWV3IE1vZGFsIEVsZW1lbnRzXG5jb25zdCBwcmV2aWV3TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3ByZXZpZXctbW9kYWxcIik7XG5jb25zdCBwcmV2aWV3TW9kYWxDbG9zZUJ1dHRvbiA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIi5tb2RhbF9fY2xvc2UtYnV0dG9uXCJcbik7XG5jb25zdCBwcmV2aWV3SW1hZ2VFbGVtZW50ID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xuY29uc3QgcHJldmlld0NhcHRpb25FbGVtZW50ID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2NhcHRpb25cIik7XG5cbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcIjVlZjMyNWM1LWY3YzEtNDcxOS1iYjMyLTEzNDE1YWQ1Nzk1N1wiLFxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxufSk7XG5cbmFwaVxuICAuZ2V0QXBwSW5mbygpXG4gIC50aGVuKChbY2FyZHMsIHVzZXJdKSA9PiB7XG4gICAgY2FyZHMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChpdGVtKTtcbiAgICAgIGNhcmRzTGlzdC5hcHBlbmQoY2FyZEVsZW1lbnQpO1xuICAgIH0pO1xuICAgIGlmIChwcm9maWxlQXZhdGFyRWxlbWVudCkge1xuICAgICAgcHJvZmlsZUF2YXRhckVsZW1lbnQuc3JjID0gdXNlci5hdmF0YXI7XG4gICAgICBwcm9maWxlQXZhdGFyRWxlbWVudC5hbHQgPSB1c2VyLm5hbWU7XG4gICAgfVxuICAgIHByb2ZpbGVOYW1lRWxlbWVudC50ZXh0Q29udGVudCA9IHVzZXIubmFtZTtcbiAgICBwcm9maWxlRGVzY3JpcHRpb25FbGVtZW50LnRleHRDb250ZW50ID0gdXNlci5hYm91dDtcbiAgfSlcbiAgLmNhdGNoKChlcnIpID0+IHtcbiAgICBjb25zb2xlLmVycm9yKGVycik7XG4gIH0pO1xuXG5mdW5jdGlvbiBvcGVuTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LmFkZChcIm1vZGFsX2lzLW9wZW5lZFwiKTtcbiAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBtb2RhbE92ZXJsYXlDbG9zZSk7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY2FwZUNsb3NlKTtcbn1cblxuZnVuY3Rpb24gY2xvc2VNb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfaXMtb3BlbmVkXCIpO1xuICBtb2RhbC5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIG1vZGFsT3ZlcmxheUNsb3NlKTtcbiAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgaGFuZGxlRXNjYXBlQ2xvc2UpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVDYXJkKGNhcmRFbGVtZW50LCBjYXJkSWQpIHtcbiAgc2VsZWN0ZWRDYXJkID0gY2FyZEVsZW1lbnQ7XG4gIHNlbGVjdGVkQ2FyZElkID0gY2FyZElkO1xuICBvcGVuTW9kYWwoZGVsZXRlTW9kYWwpO1xufVxuXG5lZGl0UHJvZmlsZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBlZGl0UHJvZmlsZU5hbWVJbnB1dC52YWx1ZSA9IHByb2ZpbGVOYW1lRWxlbWVudC50ZXh0Q29udGVudDtcbiAgZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0LnZhbHVlID0gcHJvZmlsZURlc2NyaXB0aW9uRWxlbWVudC50ZXh0Q29udGVudDtcbiAgcmVzZXRWYWxpZGF0aW9uKFxuICAgIGVkaXRQcm9maWxlRm9ybSxcbiAgICBbZWRpdFByb2ZpbGVOYW1lSW5wdXQsIGVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dF0sXG4gICAgc2V0dGluZ3NcbiAgKTtcbiAgb3Blbk1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xufSk7XG5cbnByb2ZpbGVBdmF0YXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgb3Blbk1vZGFsKHByb2ZpbGVBdmF0YXJNb2RhbCk7XG59KTtcblxucHJvZmlsZUF2YXRhckNsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGNsb3NlTW9kYWwocHJvZmlsZUF2YXRhck1vZGFsKTtcbn0pO1xuXG5lZGl0UHJvZmlsZUNsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGNsb3NlTW9kYWwoZWRpdFByb2ZpbGVNb2RhbCk7XG59KTtcblxubmV3UG9zdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBvcGVuTW9kYWwobmV3UG9zdE1vZGFsKTtcbn0pO1xuXG5uZXdQb3N0Q2xvc2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2xvc2VNb2RhbChuZXdQb3N0TW9kYWwpO1xufSk7XG5cbnByZXZpZXdNb2RhbENsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGNsb3NlTW9kYWwocHJldmlld01vZGFsKTtcbn0pO1xuXG5kZWxldGVNb2RhbENsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xufSk7XG5cbmRlbGV0ZU1vZGFsQ2FuY2VsQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xufSk7XG5cbmZ1bmN0aW9uIGhhbmRsZUF2YXRhclN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgY29uc3Qgc3VibWl0QnV0dG9uID0gZXZ0LnN1Ym1pdHRlcjtcbiAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdXR0b24sIHRydWUsIFwiU2F2ZVwiLCBcIlNhdmluZy4uLlwiKTtcblxuICBhcGlcbiAgICAuZWRpdEF2YXRhckltYWdlKHtcbiAgICAgIGF2YXRhcjogcHJvZmlsZUF2YXRhckxpbmtJbnB1dC52YWx1ZSxcbiAgICB9KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBpZiAoZGF0YSkge1xuICAgICAgICBwcm9maWxlQXZhdGFyRWxlbWVudC5zcmMgPSBkYXRhLmF2YXRhcjtcblxuICAgICAgICBkaXNhYmxlQnV0dG9uKHByb2ZpbGVBdmF0YXJTdWJtaXRCdXR0b24sIHNldHRpbmdzKTtcbiAgICAgICAgY2xvc2VNb2RhbChwcm9maWxlQXZhdGFyTW9kYWwpO1xuICAgICAgICBldnQudGFyZ2V0LnJlc2V0KCk7XG4gICAgICB9XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdXR0b24sIGZhbHNlLCBcIlNhdmVcIiwgXCJTYXZpbmcuLi5cIik7XG4gICAgfSk7XG59XG5wcm9maWxlQXZhdGFyRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUF2YXRhclN1Ym1pdCk7XG5cbmZ1bmN0aW9uIGhhbmRsZUVkaXRQcm9maWxlU3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcblxuICAvLyBDaGFuZ2UgdGV4dCBjb250ZW50IHRvIFwiU2F2aW5nLi4uXCIgb3IgXCJEZWxldGluZy4uLlwiXG4gIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGV2dC5zdWJtaXR0ZXI7XG4gIHNldEJ1dHRvblRleHQoc3VibWl0QnV0dG9uLCB0cnVlLCBcIlNhdmVcIiwgXCJTYXZpbmcuLi5cIik7XG5cbiAgYXBpXG4gICAgLmVkaXRVc2VySW5mbyh7XG4gICAgICBuYW1lOiBlZGl0UHJvZmlsZU5hbWVJbnB1dC52YWx1ZSxcbiAgICAgIGFib3V0OiBlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXQudmFsdWUsXG4gICAgfSlcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgcHJvZmlsZU5hbWVFbGVtZW50LnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICAgICAgICBwcm9maWxlRGVzY3JpcHRpb25FbGVtZW50LnRleHRDb250ZW50ID0gZGF0YS5hYm91dDtcblxuICAgICAgICBkaXNhYmxlQnV0dG9uKGVkaXRQcm9maWxlU3VibWl0QnV0dG9uLCBzZXR0aW5ncyk7XG4gICAgICAgIGNsb3NlTW9kYWwoZWRpdFByb2ZpbGVNb2RhbCk7XG4gICAgICAgIGV2dC50YXJnZXQucmVzZXQoKTtcbiAgICAgIH1cbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgfSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ1dHRvbiwgZmFsc2UsIFwiU2F2ZVwiLCBcIlNhdmluZy4uLlwiKTtcbiAgICB9KTtcbn1cbmVkaXRQcm9maWxlRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUVkaXRQcm9maWxlU3VibWl0KTtcblxuZnVuY3Rpb24gaGFuZGxlTmV3UG9zdFN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgY29uc3Qgc3VibWl0QnV0dG9uID0gZXZ0LnN1Ym1pdHRlcjtcbiAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdXR0b24sIHRydWUsIFwiU2F2ZVwiLCBcIlNhdmluZy4uLlwiKTtcblxuICBhcGlcbiAgICAuZ2V0TmV3Q2FyZCh7XG4gICAgICBuYW1lOiBuZXdQb3N0Q2FwdGlvbklucHV0LnZhbHVlLFxuICAgICAgbGluazogbmV3UG9zdExpbmtJbnB1dC52YWx1ZSxcbiAgICB9KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBpZiAoZGF0YSkge1xuICAgICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGdldENhcmRFbGVtZW50KGRhdGEpO1xuICAgICAgICBjYXJkc0xpc3QucHJlcGVuZChjYXJkRWxlbWVudCk7XG5cbiAgICAgICAgZGlzYWJsZUJ1dHRvbihuZXdQb3N0U3VibWl0QnV0dG9uLCBzZXR0aW5ncyk7XG4gICAgICAgIGNsb3NlTW9kYWwobmV3UG9zdE1vZGFsKTtcbiAgICAgICAgZXZ0LnRhcmdldC5yZXNldCgpO1xuICAgICAgfVxuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHNldEJ1dHRvblRleHQoc3VibWl0QnV0dG9uLCBmYWxzZSwgXCJTYXZlXCIsIFwiU2F2aW5nLi4uXCIpO1xuICAgIH0pO1xufVxubmV3UG9zdEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVOZXdQb3N0U3VibWl0KTtcblxuZnVuY3Rpb24gaGFuZGxlTGlrZUNhcmQoZXZ0LCBpZCkge1xuICBjb25zdCBidXR0b24gPSBldnQuY3VycmVudFRhcmdldDtcbiAgY29uc3QgaXNMaWtlZCA9IGJ1dHRvbi5jbGFzc0xpc3QuY29udGFpbnMoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XG4gIGFwaVxuICAgIC5jaGFuZ2VMaWtlKGlkLCBpc0xpa2VkKVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIGJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlU3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcblxuICBjb25zdCBzdWJtaXRCdXR0b24gPSBldnQuc3VibWl0dGVyO1xuICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ1dHRvbiwgdHJ1ZSwgXCJEZWxldGVcIiwgXCJEZWxldGluZy4uLlwiKTtcblxuICBhcGlcbiAgICAucmVtb3ZlQ2FyZChzZWxlY3RlZENhcmRJZClcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBzZWxlY3RlZENhcmQucmVtb3ZlKCk7XG4gICAgICBjbG9zZU1vZGFsKGRlbGV0ZU1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgfSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ1dHRvbiwgZmFsc2UsIFwiRGVsZXRlXCIsIFwiRGVsZXRpbmcuLi5cIik7XG4gICAgfSk7XG59XG5kZWxldGVGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlRGVsZXRlU3VibWl0KTtcblxuLy8gbW9kYWxPdmVybGF5Q2xvc2UgZmVhdHVyZVxuZnVuY3Rpb24gbW9kYWxPdmVybGF5Q2xvc2UoZXZ0KSB7XG4gIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcIm1vZGFsXCIpKSB7XG4gICAgY2xvc2VNb2RhbChldnQudGFyZ2V0KTtcbiAgfVxufVxuXG4vLyBoYW5kbGVFc2NhcGVDbG9zZSBmZWF0dXJlXG5mdW5jdGlvbiBoYW5kbGVFc2NhcGVDbG9zZShldnQpIHtcbiAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfaXMtb3BlbmVkXCIpO1xuICAgIGlmIChtb2RhbCkge1xuICAgICAgY2xvc2VNb2RhbChtb2RhbCk7XG4gICAgfVxuICB9XG59XG5cbmNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50XG4gIC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtdGVtcGxhdGVcIilcbiAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpO1xuY29uc3QgY2FyZHNMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fbGlzdFwiKTtcblxuZnVuY3Rpb24gZ2V0Q2FyZEVsZW1lbnQoZGF0YSkge1xuICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmRUZW1wbGF0ZS5jbG9uZU5vZGUodHJ1ZSk7XG4gIGNvbnN0IGNhcmRUaXRsZUVsZW1lbnQgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xuICBjb25zdCBjYXJkSW1hZ2VFbGVtZW50ID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcbiAgY29uc3QgY2FyZExpa2VCdXR0b25FbGVtZW50ID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ1dHRvblwiKTtcbiAgY29uc3QgY2FyZERlbGV0ZUJ1dHRvbkVsZW1lbnQgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgIFwiLmNhcmRfX2RlbGV0ZS1idXR0b25cIlxuICApO1xuXG4gIGNhcmRUaXRsZUVsZW1lbnQudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gIGNhcmRJbWFnZUVsZW1lbnQuc3JjID0gZGF0YS5saW5rO1xuICBjYXJkSW1hZ2VFbGVtZW50LmFsdCA9IGRhdGEubmFtZTtcblxuICBpZiAoZGF0YS5pc0xpa2VkKSB7XG4gICAgY2FyZExpa2VCdXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XG4gIH0gZWxzZSB7XG4gICAgY2FyZExpa2VCdXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XG4gIH1cblxuICBjYXJkTGlrZUJ1dHRvbkVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+XG4gICAgaGFuZGxlTGlrZUNhcmQoZXZ0LCBkYXRhLl9pZClcbiAgKTtcbiAgY2FyZERlbGV0ZUJ1dHRvbkVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XG4gICAgaGFuZGxlRGVsZXRlQ2FyZChjYXJkRWxlbWVudCwgZGF0YS5faWQpXG4gICk7XG5cbiAgY2FyZEltYWdlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgIHByZXZpZXdJbWFnZUVsZW1lbnQuc3JjID0gZGF0YS5saW5rO1xuICAgIHByZXZpZXdJbWFnZUVsZW1lbnQuYWx0ID0gZGF0YS5uYW1lO1xuICAgIHByZXZpZXdDYXB0aW9uRWxlbWVudC50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgICBvcGVuTW9kYWwocHJldmlld01vZGFsKTtcbiAgfSk7XG5cbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xufVxuIiwiY2xhc3MgQXBpIHtcclxuICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGhlYWRlcnMgfSkge1xyXG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XHJcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcclxuICB9XHJcblxyXG4gIF9jaGVja1Jlc3BvbnNlKHJlcykge1xyXG4gICAgaWYgKHJlcy5vaykge1xyXG4gICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGdldEFwcEluZm8oKSB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0SW5pdGlhbENhcmRzKCksIHRoaXMuZ2V0VXNlckluZm8oKV0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcclxuICB9XHJcblxyXG4gIGdldFVzZXJJbmZvKCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcclxuICB9XHJcblxyXG4gIGVkaXRBdmF0YXJJbWFnZSh7IGF2YXRhciB9KSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIGF2YXRhcixcclxuICAgICAgfSksXHJcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xyXG4gIH1cclxuXHJcbiAgZWRpdFVzZXJJbmZvKHsgbmFtZSwgYWJvdXQgfSkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIG5hbWUsXHJcbiAgICAgICAgYWJvdXQsXHJcbiAgICAgIH0pLFxyXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcclxuICB9XHJcblxyXG4gIGdldE5ld0NhcmQoeyBuYW1lLCBsaW5rIH0pIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIG5hbWUsXHJcbiAgICAgICAgbGluayxcclxuICAgICAgfSksXHJcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xyXG4gIH1cclxuXHJcbiAgcmVtb3ZlQ2FyZChpZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7aWR9YCwge1xyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xyXG4gIH1cclxuXHJcbiAgY2hhbmdlTGlrZShpZCwgaXNMaWtlZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7aWR9L2xpa2VzYCwge1xyXG4gICAgICBtZXRob2Q6IGlzTGlrZWQgPyBcIkRFTEVURVwiIDogXCJQVVRcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBBcGk7XHJcbiJdLCJuYW1lcyI6WyJzZXRCdXR0b25UZXh0IiwiYnV0dG9uIiwiaXNMb2FkaW5nIiwiZGVmYXVsdFRleHQiLCJsb2FkaW5nVGV4dCIsInRleHRDb250ZW50Iiwic2V0dGluZ3MiLCJmb3JtU2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsImhpZGVJbnB1dEVycm9yIiwiZm9ybUVsZW1lbnQiLCJpbnB1dEVsZW1lbnQiLCJjb25maWciLCJxdWVyeVNlbGVjdG9yIiwiaWQiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsImlucHV0TGlzdCIsImJ1dHRvbkVsZW1lbnQiLCJzb21lIiwidmFsaWRpdHkiLCJ2YWxpZCIsImhhc0ludmFsaWRJbnB1dCIsImRpc2FibGVCdXR0b24iLCJkaXNhYmxlZCIsImFkZCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJzZXRFdmVudExpc3RlbmVycyIsIkFycmF5IiwiZnJvbSIsImFkZEV2ZW50TGlzdGVuZXIiLCJjaGVja0lucHV0VmFsaWRpdHkiLCJzaG93SW5wdXRFcnJvciIsImVycm9yTWVzc2FnZSIsInZhbGlkYXRpb25NZXNzYWdlIiwicHJvZmlsZUF2YXRhckNvbnQiLCJwcm9maWxlQXZhdGFyRWxlbWVudCIsInByb2ZpbGVBdmF0YXJCdXR0b24iLCJwcm9maWxlTmFtZUVsZW1lbnQiLCJwcm9maWxlRGVzY3JpcHRpb25FbGVtZW50IiwicHJvZmlsZUF2YXRhck1vZGFsIiwicHJvZmlsZUF2YXRhckZvcm0iLCJwcm9maWxlQXZhdGFyTGlua0lucHV0IiwicHJvZmlsZUF2YXRhclN1Ym1pdEJ1dHRvbiIsInByb2ZpbGVBdmF0YXJDbG9zZUJ1dHRvbiIsImVkaXRQcm9maWxlQnV0dG9uIiwiZWRpdFByb2ZpbGVNb2RhbCIsImVkaXRQcm9maWxlU3VibWl0QnV0dG9uIiwiZWRpdFByb2ZpbGVDbG9zZUJ1dHRvbiIsImVkaXRQcm9maWxlRm9ybSIsImVkaXRQcm9maWxlTmFtZUlucHV0IiwiZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0IiwibmV3UG9zdEJ1dHRvbiIsIm5ld1Bvc3RNb2RhbCIsIm5ld1Bvc3RTdWJtaXRCdXR0b24iLCJuZXdQb3N0Q2xvc2VCdXR0b24iLCJuZXdQb3N0Rm9ybSIsIm5ld1Bvc3RMaW5rSW5wdXQiLCJuZXdQb3N0Q2FwdGlvbklucHV0Iiwic2VsZWN0ZWRDYXJkIiwic2VsZWN0ZWRDYXJkSWQiLCJkZWxldGVNb2RhbCIsImRlbGV0ZUZvcm0iLCJkZWxldGVNb2RhbENsb3NlQnV0dG9uIiwiZGVsZXRlTW9kYWxDYW5jZWxCdXR0b24iLCJwcmV2aWV3TW9kYWwiLCJwcmV2aWV3TW9kYWxDbG9zZUJ1dHRvbiIsInByZXZpZXdJbWFnZUVsZW1lbnQiLCJwcmV2aWV3Q2FwdGlvbkVsZW1lbnQiLCJhcGkiLCJjb25zdHJ1Y3RvciIsImJhc2VVcmwiLCJoZWFkZXJzIiwidGhpcyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJfY2hlY2tSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJnZXRBcHBJbmZvIiwiYWxsIiwiZ2V0SW5pdGlhbENhcmRzIiwiZ2V0VXNlckluZm8iLCJmZXRjaCIsInRoZW4iLCJlZGl0QXZhdGFySW1hZ2UiLCJhdmF0YXIiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImVkaXRVc2VySW5mbyIsIm5hbWUiLCJhYm91dCIsImdldE5ld0NhcmQiLCJsaW5rIiwicmVtb3ZlQ2FyZCIsImNoYW5nZUxpa2UiLCJpc0xpa2VkIiwiYXV0aG9yaXphdGlvbiIsIm9wZW5Nb2RhbCIsIm1vZGFsIiwibW9kYWxPdmVybGF5Q2xvc2UiLCJoYW5kbGVFc2NhcGVDbG9zZSIsImNsb3NlTW9kYWwiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZXZ0IiwidGFyZ2V0IiwiY29udGFpbnMiLCJrZXkiLCJjYXJkcyIsInVzZXIiLCJpdGVtIiwiY2FyZEVsZW1lbnQiLCJnZXRDYXJkRWxlbWVudCIsImNhcmRzTGlzdCIsImFwcGVuZCIsInNyYyIsImFsdCIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwidmFsdWUiLCJyZXNldFZhbGlkYXRpb24iLCJpbnB1dCIsInByZXZlbnREZWZhdWx0Iiwic3VibWl0QnV0dG9uIiwic3VibWl0dGVyIiwiZGF0YSIsInJlc2V0IiwiZmluYWxseSIsInByZXBlbmQiLCJjYXJkVGVtcGxhdGUiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiY2FyZFRpdGxlRWxlbWVudCIsImNhcmRJbWFnZUVsZW1lbnQiLCJjYXJkTGlrZUJ1dHRvbkVsZW1lbnQiLCJjYXJkRGVsZXRlQnV0dG9uRWxlbWVudCIsImN1cnJlbnRUYXJnZXQiLCJ0b2dnbGUiLCJoYW5kbGVMaWtlQ2FyZCIsIl9pZCIsImNhcmRJZCIsImhhbmRsZURlbGV0ZUNhcmQiXSwic291cmNlUm9vdCI6IiJ9